<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharmacie de Cession - sortie</title>
    <script src="assets\js\chart.j@4.js"></script>
    <script src="assets\js\lucide@04680.min.js"></script>
    <link href="assets\css\tailwind.min.css" rel="stylesheet">
    <link href="assets\css\all.min.css" rel="stylesheet">
    <script src="js/jquery-3.6.0.min.js"></script>
    <style>
  /* Responsive Adjustments */
@media (max-width: 768px) {
    .container {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
    }

    table {
        display: block;
        overflow-x: auto;
    }

    td, th {
        padding: 0.5rem;
        font-size: 0.875rem;
    }
}

/* Hamburger Menu Styles */
.hamburger {
    color: white;
    background-color: #16a34a;
    border-radius: 0.375rem;
    padding: 0.5rem;
    transition: background-color 0.2s;
}

.hamburger:hover {
    background-color: #15803d;
}

/* Alert/Message Styles */
#message {
    margin-top: 1rem;
    padding: 0.75rem;
    border-radius: 0.5rem;
}

#message p {
    font-size: 0.875rem;
    font-weight: 500;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.animate-pulse-soft {
    animation: pulse 2s ease-in-out infinite;
}

#side-menu:hover {
    opacity: 1;
}

/* Custom Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

/* Base Reset and Global Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    line-height: 1.6;
    background-color: #f4f7f6;
    color: #333;
}

/* Header Styles */
.header {
    background: linear-gradient(135deg, #f7a205 0%, #ff9800 100%);
    color: white;
    padding: 1.5rem;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.header h1 {
    font-weight: 700;
    font-size: 1.75rem;
    letter-spacing: -0.5px;
}

/* Container Styles */
.container {
    width: 95%;
    max-width: 1200px;
    margin: 2rem auto;
    padding: 1rem;
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

/* Action Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem 1.25rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    gap: 0.5rem;
}

.btn-primary {
    background-color: #15803d;
    color: rgb(238, 224, 36);
}

.btn-primary:hover {
    background-color: #15803d;
}

.btn-secondary {
    background-color: #15803d;
    color: rgb(216, 170, 18);
}

.btn-secondary:hover {
    background-color: #15803d;
}

.btn-danger {
    background-color: #ff5722;
    color: white;
}

.btn-danger:hover {
    background-color: #f44336;
}
#btnAjouterSortie {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background-color: #f97316; /* Couleur orange */
    color: white;
    padding: 10px 16px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
}

#btnAjouterSortie:hover {
    background-color: #ea580c; /* Couleur orange foncée */
    transform: translateY(-2px);
}

#btnAjouterSortie:active {
    background-color: #c2410c; /* Couleur orange encore plus foncée */
    transform: translateY(0);
}

#btnAjouterSortie i {
    width: 20px;
    height: 20px;
    margin-right: 8px;
}

/* Bouton Modifier */
.btnModifier {
    display: flex;
    align-items: center;
    gap: 0.25rem; /* Espacement entre les icônes et le texte */
    background-color: #facc15; /* Jaune vif (bg-yellow-500) */
    color: #ffffff; /* Texte en blanc */
    padding: 0.25rem 0.75rem; /* Espacement intérieur */
    border-radius: 0.25rem; /* Coins arrondis */
    transition: background-color 0.3s ease; /* Effet de transition pour le hover */
    margin-right: 0.5rem; /* Espacement à droite */
}

.btnModifier:hover {
    background-color: #eab308; /* Jaune foncé (bg-yellow-600) */
}

/* Bouton Supprimer */
button.flex {
    display: flex;
    align-items: center;
    gap: 0.25rem; /* Espacement entre les icônes et le texte */
    background-color: #ef4444; /* Rouge vif (bg-red-500) */
    color: #ffffff; /* Texte en blanc */
    padding: 0.25rem 0.75rem; /* Espacement intérieur */
    border-radius: 0.25rem; /* Coins arrondis */
    transition: background-color 0.3s ease; /* Effet de transition pour le hover */
}

button.flex:hover {
    background-color: #dc2626; /* Rouge foncé (bg-red-600) */
}

/* Icônes dans les boutons */
button i {
    width: 1rem; /* Taille de l'icône */
    height: 1rem;
}

/* Search and Filter Section */
.search-section {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.search-section input,
.search-section select {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 6px;
}

/* Table Styles */
.data-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-top: 1rem;
}

.data-table th {
    background-color: #f8f9fa;
    color: #495057;
    font-weight: 600;
    padding: 1rem;
    text-align: left;
    border-bottom: 2px solid #e9ecef;
}

.data-table tr {
    transition: background-color 0.2s;
}

.data-table tr:hover {
    background-color: #f1f3f5;
}

.data-table td {
    padding: 1rem;
    border-bottom: 1px solid #e9ecef;
}

.total-row {
    font-weight: bold;
    background-color: #f8f9fa;
}

/* Modal Styles */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-content {
    background: white;
    padding: 2rem;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #868e96;
}

/* Form Styles */
.form-group {
    margin-bottom: 1rem;
}

.form-control {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ced4da;
    border-radius: 6px;
}

    </style>
</head>
<body class="bg-gray-100">
    <header class="bg-orange-500 text-white text-center p-4">
        <h1 class="text-2xl font-bold">Pharmacie de Cession - Sorties de Produits</h1>
    </header>
    <div class="container">
        <div id="side-menu" class="fixed top-0 left-0 h-full bg-white shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out z-50 w-64 hover:opacity-100 group">
            <div class="absolute top-0 right-0 m-4 cursor-pointer hover:text-red-500">
                <i data-lucide="x" class="w-6 h-6"></i>
            </div>
            <nav class="p-6 pt-16">
                <h2 class="text-2xl font-bold text-green-600 mb-6">Menu</h2>
                <ul class="space-y-4">
                    <li><a href="index.html" class="text-gray-700 hover:text-green-600 transition-colors flex items-center">
                        <i data-lucide="home" class="w-5 h-5 mr-3"></i>Accueil</a></li>
                    <li><a href="stock2.html" class="text-gray-700 hover:text-green-600 transition-colors flex items-center">
                        <i data-lucide="package" class="w-5 h-5 mr-3"></i>Stock</a></li>
                    <li><a href="commande.html" class="text-gray-700 hover:text-green-600 transition-colors flex items-center">
                        <i data-lucide="shopping-cart" class="w-5 h-5 mr-3"></i>Commandes</a></li>
                    <li><a href="sorties.html" class="text-gray-700 hover:text-green-600 transition-colors flex items-center">
                        <i data-lucide="log-out" class="w-5 h-5 mr-3"></i>Sorties</a></li>
                    <li><a href="produit.html" class="text-gray-700 hover:text-green-600 transition-colors flex items-center">
                        <i data-lucide="box" class="w-5 h-5 mr-3"></i>Produits</a></li>
                    <li><a href="categorie.html" class="text-gray-700 hover:text-green-600 transition-colors flex items-center">
                        <i data-lucide="layers" class="w-5 h-5 mr-3"></i>Catégories</a></li>
                    <li><a href="fournisseurs.html" class="text-gray-700 hover:text-green-600 transition-colors flex items-center">
                        <i data-lucide="truck" class="w-5 h-5 mr-3"></i>Fournisseurs</a></li>
                </ul>
            </nav>
        </div>
    <div class="container mx-auto p-6">
        <div class="bg-white shadow-md rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Sorties de Produits</h2>
            
            <div class="flex space-x-4 mb-6">
                <button id="btnAjouterSortie" class="flex items-center space-x-2 bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">
                    <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i>
                    Enregistrer une Sortie
                </button>
                <button class="flex items-center space-x-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    <i data-lucide="printer" class="w-5 h-5 mr-2"></i>
                    Imprimer
                </button>
            </div>

            <div class="flex space-x-4 mb-6">
                <input type="text" placeholder="Produit" class="flex-1 p-2 border rounded">
                <input type="date" placeholder="Date de début" class="p-2 border rounded">
                <input type="date" placeholder="Date de fin" class="p-2 border rounded">
                <button class="flex items-center space-x-2 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    <i data-lucide="search" class="w-5 h-5 mr-2"></i>
                    Rechercher
                </button>
            </div>

            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="p-3 border">Nom du Produit</th>
                        <th class="p-3 border">Quantité Sortie</th>
                        <th class="p-3 border">Prix Unitaire</th>
                        <th class="p-3 border">Montant Total</th>
                        <th class="p-3 border">Date de Sortie</th>
                        <th class="p-3 border">Date de Expiration</th>
                        <th class="p-3 border">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="p-3 border">Produit A</td>
                        <td class="p-3 border">50</td>
                        <td class="p-3 border">12.00 €</td>
                        <td class="p-3 border">600.00 €</td>
                        <td class="p-3 border">2023-06-01</td>
                        <td class="p-3 border">Service Pédiatrie</td>
                        <td class="p-3 border">
                            <button class="btnModifier flex items-center space-x-1 bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 mr-2">
                                <i data-lucide="edit-2" class="w-4 h-4"></i>
                                Modifier
                            </button>
                            <button class="flex items-center space-x-1 bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                Supprimer
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td class="p-3 border">Produit B</td>
                        <td class="p-3 border">75</td>
                        <td class="p-3 border">18.00 €</td>
                        <td class="p-3 border">1350.00 €</td>
                        <td class="p-3 border">2023-06-02</td>
                        <td class="p-3 border">Service Urgences</td>
                        <td class="p-3 border">
                            <button class="btnModifier flex items-center space-x-1 bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 mr-2">
                                <i data-lucide="edit-2" class="w-4 h-4"></i>
                                Modifier
                            </button>
                            <button class="flex items-center space-x-1 bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                Supprimer
                            </button>
                        </td>
                    </tr>
                    <tr class="bg-gray-100 font-bold">
                        <td colspan="3" class="p-3 border text-right">Total</td>
                        <td class="p-3 border">1950.00 €</td>
                        <td colspan="4"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal pour ajouter une sortie -->
    <div id="modalAjouterSortie" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="bg-white w-11/12 md:w-1/2 mx-auto my-10 p-6 rounded-lg shadow-xl relative">
            <button class="absolute top-4 right-4 text-gray-600 hover:text-red-500">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h2 class="text-xl font-semibold mb-4 text-center">Ajouter une nouvelle Sortie</h2>
            
            <form id="formAjouterSortie" class="space-y-4">
                <select id="id_produit" class="w-full p-2 border rounded">
                    <option>Sélectionner un produit</option>
                </select>
                <input type="number" placeholder="Quantité" class="w-full p-2 border rounded">
                <input type="number" placeholder="Prix Unitaire" class="w-full p-2 border rounded">
                <input type="date" placeholder="Date de Sortie" class="w-full p-2 border rounded">
                <input type="date" placeholder="Date d'Expiration" class="w-full p-2 border rounded">
                
                <button class="w-full bg-green-500 text-white p-2 rounded hover:bg-green-600">
                    Ajouter
                </button>
            </form>
        </div>
    </div>
<script>

   // Initialize Lucide icons
lucide.createIcons();

$(document).ready(function() {
    // Side Menu Functionality
    function initializeSideMenu() {
        const sideMenu = $('#side-menu');
        const menuTriggerWidth = 50;

        $('<div>')
            .css({
                position: 'fixed',
                top: 0,
                left: 0,
                bottom: 0,
                width: `${menuTriggerWidth}px`,
                zIndex: 40,
            })
            .on('mouseenter', function() {
                sideMenu.removeClass('-translate-x-full');
            })
            .appendTo('body');

        sideMenu.on('mouseleave', function() {
            $(this).addClass('-translate-x-full');
        });
    }

    initializeSideMenu(); // Ensure side menu initialization is called

    // Variables globales pour les modals
    const btnAjouterSortie = document.getElementById("btnAjouterSortie");
    const modalAjouterSortie = document.getElementById("modalAjouterSortie");
    const modalModifierSortie = document.getElementById("modalModifierSortie");
    const closeButtons = document.querySelectorAll(".close");

    // Gestion des modals
    if (btnAjouterSortie) {
        btnAjouterSortie.addEventListener("click", function() {
            modalAjouterSortie.style.display = "block";
        });
    }

    function openModalModifierSortie(code, nom, quantite, prixUnitaire, prixTotal, dateSortie, dateExpiration) {
        document.getElementById("code_sortie_modifier").value = code;
        document.getElementById("produit_id_modifier").value = nom;
        document.getElementById("quantite_modifier").value = quantite;
        document.getElementById("prix_unitaire_modifier").value = prixUnitaire;
        document.getElementById("prix_total_modifier").value = prixTotal;
        document.getElementById("date_sortie_modifier").value = dateSortie;
        document.getElementById("date_expiration_modifier").value = dateExpiration;
        modalModifierSortie.style.display = "block";
    }

    // Fermeture des modals
    closeButtons.forEach(btn => {
        btn.addEventListener("click", function() {
            modalAjouterSortie.style.display = "none";
            modalModifierSortie.style.display = "none";
        });
    });

    window.addEventListener("click", function(event) {
        if (event.target === modalAjouterSortie) {
            modalAjouterSortie.style.display = "none";
        }
        if (event.target === modalModifierSortie) {
            modalModifierSortie.style.display = "none";
        }
    });

    // Stocker les données des produits
    let productsData = [];

    // Fonction pour charger les produits
    function loadProducts() {
        $.ajax({
            url: 'get_products.php',
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                if (response.status === 'success') {
                    productsData = response.data;
                    const productSelect = document.getElementById('id_produit');
                    productSelect.innerHTML = '<option value="">Sélectionner un produit</option>';
                    productsData.forEach(product => {
                        const option = new Option(product.nom, product.id);
                        productSelect.add(option);
                    });
                } else {
                    console.error('Erreur lors du chargement des produits:', response.message);
                }
            },
            error: function(xhr, status, error) {
                console.error('Erreur AJAX lors du chargement des produits:', error);
            }
        });
    }

    // Gestion des sorties
    $('#btn_enregistrer_sortie').on('click', function() {
        const formData = {
            code: $('#code_sortie').val(),
            id_produit: $('#id_produit').val(),
            quantite: parseFloat($('#quantite').val()) || 0,
            prix_unitaire: parseFloat($('#prix_unitaire').val()) || 0,
            prix_total: parseFloat($('#quantite').val()) * parseFloat($('#prix_unitaire').val()),
            date_sortie: $('#date_sortie').val(),
            date_expiration: $('#date_expiration').val()
        };

        if (!formData.id_produit || !formData.quantite || !formData.prix_unitaire || !formData.date_sortie || !formData.date_expiration) {
            $('#message_sortie').html('<p style="color: red;">Veuillez remplir tous les champs requis</p>');
            return;
        }

        $.ajax({
            type: 'POST',
            url: 'sortie_magazin.php',
            data: formData,
            dataType: 'json',
            success: function(response) {
                if (response.status === 'success') {
                    $('#message_sortie').html('<p style="color: green;">' + response.message + '</p>');
                    $('#formAjouterSortie')[0].reset();
                    getListeSorties();
                    setTimeout(function() {
                        modalAjouterSortie.style.display = "none";
                        $('#message_sortie').html('');
                    }, 2000);
                } else {
                    $('#message_sortie').html('<p style="color: red;">' + response.message + '</p>');
                }
            },
            error: function(error) {
                $('#message_sortie').html('<p style="color: red;">Erreur lors de l\'enregistrement: ' + error.responseText + '</p>');
            }
        });
    });

    $('#quantite, #prix_unitaire').on('input', function() {
        const quantite = parseFloat($('#quantite').val()) || 0;
        const prix_unitaire = parseFloat($('#prix_unitaire').val()) || 0;
        $('#prix_total').val(quantite * prix_unitaire);
    });

    // Fonction pour remplir la liste des sorties
    function getListeSorties() {
        $.ajax({
            url: 'sortie_get_liste.php',
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                $('tbody').empty();

                if (response.donnees && response.donnees.length > 0) {
                    response.donnees.forEach(function(sortie) {
                        const row = `<tr>
                            <td>${sortie.nom || ''}</td>
                            <td>${sortie.quantite || ''}</td>
                            <td>${sortie.prix_unitaire || ''}</td>
                            <td>${sortie.prix_total || ''}</td>
                            <td>${sortie.date_sortie || ''}</td>
                            <td>${sortie.date_expiration || ''}</td>
                            <td>
                                <button class="btn btnModifier">Modifier</button>
                                <button class="btn btnSupprimer">Supprimer</button>
                            </td>
                        </tr>`;
                        $('tbody').append(row);
                    });
                } else {
                    $('tbody').append('<tr><td colspan="8">Aucune sortie trouvée.</td></tr>');
                }
            },
            error: function(error) {
                $('tbody').append('<tr><td colspan="8" style="color:red;">Erreur lors de la récupération des sorties: ' + error + '</td></tr>');
            }
        });
    }

    // Charger les produits et les sorties au chargement de la page
    loadProducts();
    getListeSorties();
});

    </script> 

</body>
</html>